var svgDir='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512"><path d="M357.84 398.577l61.104-162.945h-264.784l-61.104 162.945zM133.792 215.264l-40.736 183.312v-264.784h91.655l40.736 40.736h132.393v40.736z"></path></svg>';
var svgFile='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 384 512"><path d="M161.448 215.264l-50.92 50.92 50.92 50.92 20.368-20.368-30.552-30.552 30.552-30.552-20.368-20.368zM202.184 235.632l30.552 30.552-30.552 30.552 20.368 20.368 50.92-50.92-50.92-50.92-20.368 20.368zM253.104 113.424h-183.312v285.152h244.417v-224.048l-61.104-61.104zM293.84 378.209h-203.68v-244.417h142.577l61.104 61.104v183.312z"></path></svg>';
var svgOpen='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 768 768"><path d="M216.736 154.010h146.358q8.658 0 14.783 6.125t6.125 14.783-6.126 14.783-14.783 6.126h-146.358q-8.658 0-14.783 6.126t-6.125 14.783v334.532q0 8.658 6.125 14.783t14.783 6.125h334.532q8.658 0 14.783-6.125t6.126-14.783v-146.358q0-8.657 6.125-14.783t14.783-6.125 14.783 6.125 6.126 14.783v146.358q0 25.972-18.377 44.347t-44.347 18.377h-334.532q-25.972 0-44.347-18.377t-18.377-44.347v-334.532q0-25.972 18.377-44.347t44.347-18.377zM467.632 154.010h125.449q8.658 0 14.783 6.125t6.125 14.783v125.449q0 8.658-6.125 14.783t-14.783 6.126-14.783-6.126-6.126-14.783v-74.976l-173.473 173.473q-6.044 6.044-14.702 6.044-8.984 0-14.947-5.961t-5.961-14.948q0-8.657 6.044-14.702l173.473-173.473h-74.976q-8.657 0-14.783-6.126t-6.125-14.783 6.125-14.783 14.783-6.126z"></path></svg>';
var svgSearch='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 640 640"><path d="M123.345 462.519l98.497-98.497c-14.857-24.421-23.406-53.040-23.406-83.717 0-89.035 77.176-166.211 166.238-166.211 89.035 0 161.233 72.198 161.233 161.233 0 89.061-77.149 166.237-166.211 166.237-29.609 0-57.341-8.028-81.19-21.972l-99.019 99.044c-9.722 9.696-25.412 9.696-35.083 0l-24.579-24.552c-9.67-9.696-6.151-21.894 3.519-31.564zM476.281 275.326c0-61.642-49.965-111.633-111.607-111.633-61.668 0-116.611 54.944-116.611 116.611s49.964 111.633 111.633 111.633 116.586-54.943 116.586-116.611z"></path></svg>';
var svgOrder='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 384 512"><path d="M170.274 277.726h152.082v-43.452h-152.082v43.452zM170.274 364.63h152.082v-43.452h-152.082v43.452zM170.274 147.37v43.452h152.082v-43.452h-152.082zM88.463 234.274h26.478v-86.904h-12.221l-28.855 7.809v16.973l14.597-0.679v62.802zM125.804 304.204c0-12.221-4.074-26.478-32.589-26.478-11.203 0-21.725 2.036-28.177 5.432l0.34 22.406c7.129-3.394 14.258-5.092 22.745-5.092s10.863 3.734 10.863 9.505c0 8.827-10.184 19.69-37.342 38.021v16.973h65.177v-22.745l-30.892 0.678c16.634-10.184 29.534-22.406 29.534-38.36l0.34-0.339z"></path></svg>';
var svgAscend='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512"><path d="M330.158 256v148.315h24.719v-148.315h61.798l-74.157-74.157-74.158 74.157z"></path><path d="M82.965 132.404h37.079v24.719h-37.079v-24.719z"></path><path d="M132.404 132.404h37.079v24.719h-37.079v-24.719z"></path><path d="M181.843 132.404h24.719v37.079h-24.719v-37.079z"></path><path d="M82.965 218.921h24.719v37.079h-24.719v-37.079z"></path><path d="M120.044 231.281h37.079v24.719h-37.079v-24.719z"></path><path d="M169.483 231.281h37.079v24.719h-37.079v-24.719z"></path><path d="M82.965 169.483h24.719v37.079h-24.719v-37.079z"></path><path d="M181.843 181.843h24.719v37.079h-24.719v-37.079z"></path><path d="M181.843 330.158v74.158h-74.157v-74.158h74.157zM206.561 305.438h-123.597v123.596h123.597v-123.596z"></path></svg>';
var svgDescend='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512"><path d="M330.158 256v-148.315h24.719v148.315h61.798l-74.157 74.158-74.158-74.158z"></path><path d="M82.965 379.596h37.079v-24.719h-37.079v24.719z"></path><path d="M132.404 379.596h37.079v-24.719h-37.079v24.719z"></path><path d="M181.843 379.596h24.719v-37.079h-24.719v37.079z"></path><path d="M82.965 293.079h24.719v-37.079h-24.719v37.079z"></path><path d="M120.044 280.719h37.079v-24.719h-37.079v24.719z"></path><path d="M169.483 280.719h37.079v-24.719h-37.079v24.719z"></path><path d="M82.965 342.517h24.719v-37.079h-24.719v37.079z"></path><path d="M181.843 330.158h24.719v-37.079h-24.719v37.079z"></path><path d="M181.843 181.843v-74.157h-74.157v74.157h74.157zM206.561 206.561h-123.597v-123.597h123.597v123.597z"></path></svg>';
var svgTime='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 544 512"><path d="M288.589 103.918c83.993 0 152.082 68.089 152.082 152.082s-68.089 152.082-152.082 152.082v-32.589c31.918 0 61.925-12.43 84.494-34.998s34.998-52.576 34.998-84.494c0-31.917-12.43-61.925-34.998-84.494s-52.576-34.999-84.494-34.999c-31.918 0-61.925 12.429-84.494 34.999-17.36 17.359-28.713 39.122-33.032 62.768h63.212l-76.040 86.904-76.040-86.904h55.866c10.543-73.698 73.915-130.356 150.53-130.356zM353.767 234.274v43.452h-86.904v-108.629h43.452v65.178z"></path></svg>';
var svgEdit='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 640 640"><path d="M502.663 137.337c-24.626-24.626-46.526-17.364-46.526-17.364l-193.054 192.898-32.47 96.515 96.471-32.493 192.942-193.033c0 0 7.24-21.901-17.364-46.526zM333.52 355.867l-10.526 10.503-32.918 11.174c-2.324-5.364-5.229-10.659-11.129-16.536-5.899-5.9-11.174-8.805-16.536-11.129l11.174-32.918 10.526-10.503c0 0 17.341-1.989 34.346 15.040 17.029 17.006 15.063 34.37 15.063 34.37zM454.081 476.428h-290.509v-290.509h111.734l44.693-44.693h-156.428c-24.582 0-44.693 20.112-44.693 44.693v290.509c0 24.582 20.112 44.693 44.693 44.693h290.509c24.582 0 44.693-20.112 44.693-44.693v-156.428l-44.693 44.693v111.734z"></path></svg>';
var svgCreate='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 768 768"><path d="M280.535 238.669v51.733h155.198v-51.733h-155.197zM280.535 342.134h232.797v-25.866h-232.797v25.866zM513.331 368h-206.93v25.866h206.93v-25.866zM513.331 445.6v-25.866h-181.064v25.866h181.064zM280.535 419.733h-77.599v77.599h-77.6v77.599h77.6v77.599h77.599v-77.599h77.6v-77.599h-77.6v-77.599zM177.070 109.338v258.662h51.733v-206.93h336.262v439.726h-171.829l-25.866 51.733h249.428v-543.191h-439.726z"></path></svg>';

//gets a query string json from the url
function getQs(){
  var qs={};
  var fromUrl=document.location.href;
  if(fromUrl.indexOf('?')!==-1){
    fromUrl=fromUrl.substring(fromUrl.indexOf('?')+'?'.length);
    var qsArray=fromUrl.split('&');
    for(var q=0;q<qsArray.length;q++){
      var qsStr=qsArray[q];
      var keyVal=qsStr.split('=');
      if(keyVal.length>1){
        var key=keyVal[0].trim();
        var val=keyVal[1].trim();
        qs[key]=val;
      }
    }
  } return qs;
}
function getActiveTabLi(){
  return jQuery('#tabs:first').children('ul:first').children('li.active[path]:first');
}
function getTemplateTabLi(){
  return jQuery('#tabs:first').children('ul:first').children('li.template:first');
}
function getElemPath(arg){
  var path;
  if(arg!=undefined){
    if(typeof arg==='string'){
      path=arg;
      if(path!=='.'){
        //make sure this is a real path and not just a random string
        if(jQuery('#tabs > ul > li[path="'+path+'"]:first').length<1){path=undefined;}
      }else{
        //get the current active for '.'
        var li=getActiveTabLi();
        path=li.attr('path');
        if(path!=undefined){
          path=path.trim();
          if(path.length<1){path=undefined;}
        }
      }
    }else if(arg.attr){
      //if this element doesn't have a path attribute
      path=arg.attr('path');
      if(path==undefined){path='';}
      if(path.length<1){
        //if a parent element has a path attribute
        var parent=arg.parents('[path]:first');
        if(parent.length>0){
          path=parent.attr('path');
        }else{
          //no path associated with this element
          path=undefined;
        }
      }
    }
  }
  return path;
}
function getPathName(which){
  var name;
  var path=getElemPath(which);
  if(path!=undefined){
    name=path;
    if(name.indexOf('/')!==-1){
      name=name.substring(name.lastIndexOf('/')+'/'.length);
    }
  }
  return name;
}
function getEditorDiv(which){
  var div;
  var path=getElemPath(which);
  if(path!=undefined){
    div=jQuery('#file-content:first').children('div[path="'+path+'"]:first');
    if(div.length<1){
      div=undefined;
    }
  }
  return div;
}
function getCodeMirrorObj(which){
  var cm;
  //if there is a codemirror object for this
  var div=getEditorDiv(which);
  if(div!=undefined){
    if(div[0].hasOwnProperty('codeMirror')){
      cm=div[0]['codeMirror'];
    }
  }
  return cm;
}
function getPathExt(which){
  var ext;
  var path=getElemPath(which);
  if(path!=undefined){
    ext=path;
    if(ext.indexOf('.')!==-1){
      ext=ext.substring(ext.lastIndexOf('.')+'.'.length);
    } ext=ext.toLowerCase(); ext=ext.trim();
    if(ext==='html'){
      var tabLi=getTabLi(path);
      if(tabLi.hasClass('template')){
        ext='template';
      }
    }
  }
  return ext;
}
function getTabLi(which){
  var li;
  var path=getElemPath(which);
  if(path!=undefined){
    li=jQuery('#tabs:first').children('ul:first').children('li[path="'+path+'"]:first');
    if(li.length<1){
      li=undefined;
    }
  }
  return li;
}
//get the current editor code for a tab
function getFileContent(which){
  var content;
  var div=getEditorDiv(which);
  if(div!=undefined){
    //if the code mirror editor is initialized for this div
    if(div[0].hasOwnProperty('codeMirror')){
      content=div[0]['codeMirror']['object'].getValue();
    }else{
      //code mirror not initialized, so just get the content from the textarea
      var ta=div.children('textarea.raw:first');
      if(ta.length>0){
        content=ta.val();
      }
    }
  }
  return content;
}
//get the ordered file contents (from the editor)
function getFileContents(json){
  var data=[];
  var temLi=getTemplateTabLi();
  if(temLi.length>0){
    var temPath=getElemPath(temLi);
    if(temPath!=undefined){
      //function to make sure a file contains one or more strings
      var hasSome=function(cont){
        var include=false;
        if(json.hasOwnProperty('has_some') && json.has_some.length>0){
          if(cont!=undefined){
            for(var c=0;c<json.has_some.length;c++){
              if(cont.indexOf(json.has_some[c])!==-1){
                include=true;
                break;
              }
            }
          }
        }else{
          include=true;
        }
        return include;
      };
      //function to make sure a file contains one or more strings
      var hasAll=function(cont){
        var include=true;
        if(json.hasOwnProperty('has_all') && json.has_all.length>0){
          if(cont!=undefined){
            for(var c=0;c<json.has_all.length;c++){
              if(cont.indexOf(json.has_all[c])===-1){
                include=false;
                break;
              }
            }
          }else{
            include=false;
          }
        }
        return include;
      };
      var stopBefore=function(which){
        var stopNow=false;
        if(json!=undefined){
          if(json.hasOwnProperty('stop_before')){
            var name=getPathName(which);
            var stopName=json['stop_before'];
            if(stopName==='.'){
              stopName=getPathName('.');
            }
            if(stopName===name){
              stopNow=true;
            }
          }
        }
        return stopNow;
      };
      var stopAfter=function(which){
        var stopNow=false;
        if(json!=undefined){
          if(json.hasOwnProperty('stop_after')){
            var name=getPathName(which);
            var stopName=json['stop_after'];
            if(stopName==='.'){
              stopName=getPathName('.');
            }
            if(stopName===name){
              stopNow=true;
            }
          }
        }
        return stopNow;
      };
      //function to decide if this file's data should be included in return
      var includeData=function(which){
        //include file data based on include exclude rules
        var include=true;
        if(json!=undefined){
          var ext=getPathExt(which);
          if(json.hasOwnProperty('include_ext')){
            include=false;
            if(json['include_ext'].indexOf(ext)!==-1){
              include=true;
            }
          }
          if(json.hasOwnProperty('exclude_ext')){
            if(json['exclude_ext'].indexOf(ext)!==-1){
              include=false;
            }
          }
        }
        return include;
      };
      if(!stopBefore(temPath)){
        //get the template.html content
        var temContent=getFileContent(temPath);
        if(includeData(temPath)){
          if(hasAll(temContent)){
            if(hasSome(temContent)){
              data.push({path:temPath, content:temContent});
            }
          }
        }
        if(!stopAfter(temPath)){
          var tabsUl=jQuery('#tabs:first').children('ul:first');
          //get all of the potential file names between [...] TRIANGLE_STRIP
          var matches=temContent.match(/\[(.*?)\]/g); var prevMatch='';
          for(var m=0;m<matches.length;m++){
            var match=matches[m];
            match=match.substring('['.length);
            match=match.substring(0, match.length-']'.length);
            var prevPath='';
            if(match.trim().indexOf('/')===0){
              if(prevMatch.trim()===match.substring(match.indexOf('/')+'/'.length).trim()){
                //get the tab with this file name
                var li=tabsUl.children('li[path$="'+prevMatch+'"]:first');
                var liPath=getElemPath(li); prevPath=liPath;
                if(liPath!=undefined){
                  if(!stopBefore(liPath)){
                    //include this tab's file data?
                    if(includeData(liPath,liContent)){
                      var liContent=getFileContent(liPath);
                      if(hasAll(liContent)){
                        if(hasSome(liContent)){
                          data.push({path:liPath, content:liContent});
                        }
                      }
                    }
                  }else{
                    break;
                  }
                }
              }
            }
            prevMatch=match;
            if(stopAfter(prevPath)){
              break;
            }
          }
        }
      }
    }
  }
  return data;
}
//function to get a date string
function getDateStr(date){
  if(date==undefined){ date=new Date(); }
  var y=date.getFullYear()+'.';
  var m=(date.getMonth()+1)+'.';
  var d=date.getDate()+'.';
  var h=date.getHours()+'.';
  var min=date.getMinutes()+'.';
  var s=date.getSeconds()+'';
  return y+m+d+h+min+s;
}
function getDateFromStr(str){
  var date;
  if(str!=undefined){
    if(typeof str==='string'){
      if(str.length>0){
        if(str.indexOf('.')!==-1){
          var parts=str.split('.');
          if(parts.length===6){
            var y=parseInt(parts[0]); var m=parseInt(parts[1]); var d=parseInt(parts[2]);
            var h=parseInt(parts[3]); var min=parseInt(parts[4]); var s=parseInt(parts[5]);
            date=new Date(y, m, d, h, min, s, 0);
          }
        }
      }
    }
  }
  return date;
}
function getFormattedDate(date){
  var str='';
  
  return str;
}
